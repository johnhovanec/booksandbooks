extends ../layout

block content
	.col-sm-9.mainContent
		table.mainTable
			thead
				tr: th: th: h3 Featured Titles
			tbody.itemsTable
				tr
					each book, index in books
						if (index > 0 && index % 3 === 0) 
							tr 
						td
							a(href="books/" + book._id)
								img(height='175px' src="/art/" + book.imgPath)
							ul
								li #[span(class='metaField') Title:] #{book.title}
								li #[span(class='metaField') Author:] #{book.authorFName} #{book.authorLName}
								// Need to convert price value to currency format
								li #[span(class='metaField') Price:] #[span(class='metaFieldPrice') $#{book.price/100}]	

		- console.log("@-@ PMin= " + pageMin + " PageMax = " + pageMax + " total  = " + total);
	
		// Display count of items on page and the total number of items; unless at end of items with only one to display
		if pageMax < total
			p Results #{+pageMin + 1}-#{pageMax} of #{total}
		else
			p Results #{+pageMin + 1} of #{total}
		
		//Show Prev button if past first page
		if pageMin > 0
			//a(href="/books/" + (pageMin - itemsPerPage))
			a(href="javascript:void(0);")
				button.btn.btn-paging(type='button')
					| Prev

		//Show Next button if unless it's the last page
		if !(pageMax >= total)			
			a(href="javascript:void(0);")
				button.btn.btn-paging(type='button' onclick="onNext()")
					| Next

		hr
		a(href="books/checkout")
			button.btn.btn-primary(type='button')
				i.fa.fa-check
				| Checkout
		hr
	include ../partials/sidebar		

	script.

		// Paging - Next button
		function onNext() {
			//event.preventDefault();
			$('.itemsTable').remove();  // remove existing records
			//$('#results').remove();

			console.log("onNext clicked");
			$.ajax({
				url: '/pageNext',
				//data: { 'pageMin' : pageMin, 'pageMax' : pageMax, 'total' : total },
				type: "get",
				cache: false,
				success: function (data) {
					console.log("onNext success: length =" + data.books.length);
					$(".mainTable").append("<tbody class='itemsTable'></tbody>");
					var itemsPerRow = 3
					var totalRows = data.books.length/itemsPerRow;
					var bookIndex = 0;
					for (row = 0; row < totalRows; row++) {
					    $('.itemsTable').append("<tr id='insertRow" + row + "' ></tr>");
					    for (var col = 0; col < itemsPerRow; col++) {
					       $("#insertRow"+row).append("<td><a href='/books/" + data.books[bookIndex]._id + "'><img height='175' src='/art/"+data.books[bookIndex].imgPath + "'</a><br><span class='metaField'> Title:  </span>"  +  data.books[bookIndex].title +  "<br><span class='metaField'> Author:  </span>" + data.books[bookIndex].authorFName + " " + data.books[bookIndex].authorLName + "<br><span class='metaField'> Price:  </span><span class='metaFieldPrice'>" + data.books[bookIndex].price/100 + "</span></td>");
					       bookIndex++;
					    }
					}

					//- $.each(data.books, function( i, field) {
					 	
					//-  		$('.itemsTable').append("<tr id='insertRow" + i + "' ></tr>");
				 //- 		}
				 //- 		//$('.itemsTable').append("<tr id='insertRow></tr></tbody>")
				 //- 		$("#insertRow"+i).append("<td><img height='175' src='/art/"+data.books[i].imgPath + "'<br>"  +  data.books[i].title +  "<br>" + data.books[i].authorFName + " " + data.books[i].authorLName + "<br>" + data.books[i].price/100 + "</td>");
					 	
					 	//- $("#insertRow").append("<td><img height='175' src='/art/"+data.books[i].imgPath + "'<br>"  +  data.books[i].title + "<br>" + data.books[i].authorFName + " " + data.books[i].authorLName + "<br>" + data.books[i].price/100 + "</td>");
					 //- });
					//debugger;
					//- $('.resultDiv').prepend("<p id='results'> Results " + parseInt(data.pageMin + 1) + "-" + data.pageMax + " of " + data.total + "</p>");


				},
				error: function (xhr, ajaxOptions, thrownError) {
					//$('#lblCommentsNotification').text("Error encountered while saving the comments.");
					console.log("onNext  err");
				},
			});

		 }

